useEffect(() => {
    // var channel = pusher.subscribe("my-channel");
    const handleEvent = async (data: Message) => {
      if (
        (data.idReceiver === selectedFriend.id1 &&
          data.idSender === selectedFriend.id2) ||
        (data.idReceiver === selectedFriend.id2 &&
          data.idSender === selectedFriend.id1)
      ) {
        const messagat = await getAllMessages({
          id1: userId,
          id2:
            selectedFriend.id1 == userId
              ? selectedFriend.id2
              : selectedFriend.id1,
        });
        dispatch(setListOfMessages(messagat));
      }
      toast(
        <div className="flex flex-col justify-center text-black gap-2">
          <div className="flex flex-row justify-start items-center gap-2">
            <Avatar
              src={
                selectedFriend.id1 == userId
                  ? selectedFriend.image2
                  : selectedFriend.image1
              }
              name={data.usernameReceiver}
              size="40"
              round={true}
            />
            <div className="flex flex-col">
              <p className="font-bold text-md">{data.usernameSender}</p>
              <span className="text-xs font-medium">
                {formatTimestamp(String(data?.createdAt))}
              </span>
            </div>
          </div>
          <p>{data.message}</p>
        </div>
      );
    };

    const channel = "private-message-" + userId;
    console.log("11111111");
    console.log(selectedFriend.id1, selectedFriend.id2);
    console.log("22222222");
    const pubnubHandleFunction = async (data: Message) => {
      // handleEvent(event.message as Message);
      const currentSelectedFriend = selectedFriendRef.current;

      if (
        (data.idReceiver === currentSelectedFriend.id1 &&
          data.idSender === currentSelectedFriend.id2) ||
        (data.idReceiver === currentSelectedFriend.id2 &&
          data.idSender === currentSelectedFriend.id1)
      ) {
        // console.log("3333333333");
        // console.log(selectedFriend.id1, selectedFriend.id2);
        // console.log("4444444444");
        // console.log(data);
        toast(
          <div className="flex flex-col justify-center text-black gap-2">
            <div className="flex flex-row justify-start items-center gap-2">
              <Avatar
                src={
                  selectedFriend.id1 == userId
                    ? selectedFriend.image2
                    : selectedFriend.image1
                }
                name={data.usernameReceiver}
                size="40"
                round={true}
              />
              <div className="flex flex-col">
                <p className="font-bold text-md">{data.usernameSender}</p>
                <span className="text-xs font-medium">
                  {formatTimestamp(String(data?.createdAt))}
                </span>
              </div>
            </div>
            <p>{data.message}</p>
          </div>
        );
      }
    };

    (pubnub as any).subscribe({ channels: [channel] });
    pubnub.addListener({
      message: async (event: any) => {
        // handleEvent(event.message as Message);
        await pubnubHandleFunction(event.message as Message);
      },
    });

    // Cleanup function
    return () => {
      pubnub.unsubscribe({ channels: [channel] });
      pubnub.removeListener({
        message: async (event: any) => {
          await pubnubHandleFunction(event.message as Message);
        },
      });
    };
  }, [userId]);
